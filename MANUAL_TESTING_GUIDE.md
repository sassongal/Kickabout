# מדריך בדיקות ידניות - Manual Testing Guide

## 🎯 מטרת המדריך
מדריך זה נועד לבדוק שכל הפיצ'רים המרכזיים עובדים לאחר הפרסום של Firebase Functions, Rules, ו-Indexes.

---

## 📱 הכנה לבדיקות

### לפני שמתחילים:
1. **ודא שהאפליקציה רצה**: `flutter run -d android`
2. **ודא ש-Firebase Functions מפורסמות**: `firebase deploy --only functions`
3. **ודא ש-Firestore Rules מפורסמות**: `firebase deploy --only firestore:rules`
4. **פתח את Firebase Console** כדי לעקוב אחרי הלוגים בזמן הבדיקות

### איפה לבדוק:
- **Firebase Console → Functions → Logs**: לראות אם Functions מופעלות
- **Firebase Console → Firestore → Data**: לראות אם נתונים נוצרים
- **Firebase Console → Cloud Messaging**: לראות אם התראות נשלחות

---

## ✅ בדיקה 1: אימות משתמש (User Authentication)

### צעד 1.1: הרשמה עם אימייל וסיסמה
1. פתח את האפליקציה
2. לחץ על "הרשמה" או "Sign Up"
3. מלא פרטים:
   - אימייל: `test@example.com` (או כל אימייל אחר)
   - סיסמה: `Test123456!` (לפחות 8 תווים)
   - שם: `משתמש בדיקה`
4. לחץ "הירשם"

**✅ מה לבדוק:**
- [ ] האם ההרשמה הצליחה?
- [ ] האם אתה מועבר למסך הבית?
- [ ] האם שם המשתמש מופיע במסך הפרופיל?

**❌ אם נכשל:**
- בדוק את הלוגים ב-Firebase Console → Authentication
- ודא ש-Email/Password מופעל ב-Firebase Console → Authentication → Sign-in method

---

### צעד 1.2: התחברות עם Google
1. לחץ על "התחבר עם Google"
2. בחר חשבון Google
3. אשר הרשאות

**✅ מה לבדוק:**
- [ ] האם ההתחברות הצליחה?
- [ ] האם אתה מועבר למסך הבית?
- [ ] האם פרטי החשבון Google מופיעים בפרופיל?

**❌ אם נכשל:**
- ודא ש-Google Sign-In מופעל ב-Firebase Console
- בדוק את ה-SHA-1 fingerprint ב-Android app configuration

---

### צעד 1.3: יצירת משתמש אנונימי
1. לחץ על "המשך כאנונימי" או "Continue as Guest"
2. אשר את הפעולה

**✅ מה לבדוק:**
- [ ] האם המשתמש האנונימי נוצר?
- [ ] האם אתה יכול לגשת לפיצ'רים בסיסיים?

---

## ✅ בדיקה 2: יצירת Hub

### צעד 2.1: יצירת Hub חדש
1. היכנס למסך "האבים" או "Hubs"
2. לחץ על כפתור "+" או "צור האב חדש"
3. מלא פרטים:
   - **שם**: `האב בדיקה`
   - **תיאור**: `זה האב לבדיקות`
   - **מיקום**: בחר מיקום על המפה (או הזן כתובת)
   - **לוגו**: העלה תמונה (אופציונלי)
4. לחץ "צור"

**✅ מה לבדוק:**
- [ ] האם ההאב נוצר בהצלחה?
- [ ] האם אתה מועבר למסך פרטי ההאב?
- [ ] האם שם ההאב מופיע נכון?
- [ ] האם המיקום נשמר?

**❌ אם נכשל:**
- בדוק את הלוגים ב-Firebase Console → Firestore
- ודא שהנתונים נוצרים ב-`/hubs/{hubId}`
- בדוק את Firestore Rules - האם יש הרשאה ליצור hubs?

**🔍 בדיקה נוספת ב-Firebase Console:**
- לך ל-Firestore → Data → hubs
- ודא שההאב החדש מופיע שם
- בדוק שכל השדות נשמרו נכון

---

## ✅ בדיקה 3: יצירת Game + פוסט אוטומטי בפיד

### צעד 3.1: יצירת משחק חדש
1. היכנס להאב שיצרת (או האב קיים)
2. לחץ על "צור משחק" או "Create Game"
3. מלא פרטים:
   - **תאריך ושעה**: בחר תאריך עתידי
   - **מגרש**: בחר מגרש (או השאר ריק)
   - **מספר שחקנים**: בחר מספר (למשל 22)
   - **תיאור**: `משחק בדיקה`
4. לחץ "צור משחק"

**✅ מה לבדוק:**
- [ ] האם המשחק נוצר בהצלחה?
- [ ] האם אתה מועבר למסך המשחק?

**🔍 בדיקה ב-Firebase Console:**
- לך ל-Firestore → Data → games
- ודא שהמשחק החדש מופיע שם
- בדוק שהשדה `hubId` מכיל את ה-ID של ההאב

---

### צעד 3.2: בדיקת פוסט אוטומטי בפיד (onGameCreated)

**זו הבדיקה החשובה ביותר!**

1. אחרי שיצרת משחק, לך למסך **"פיד"** או **"Feed"** של ההאב
2. לחץ על הטאב "פיד פעילות" או "Activity Feed"

**✅ מה לבדוק:**
- [ ] האם מופיע פוסט חדש בפיד?
- [ ] האם הפוסט מכיל את הטקסט: `משחק חדש נוצר ב-[שם ההאב]!`?
- [ ] האם הפוסט מכיל את שם יוצר המשחק?
- [ ] האם הפוסט מכיל את תאריך/שעה של יצירת המשחק?

**❌ אם הפוסט לא מופיע:**
1. **בדוק את Firebase Functions:**
   - לך ל-Firebase Console → Functions → Logs
   - חפש את הפונקציה `onGameCreated`
   - בדוק אם יש שגיאות

2. **בדוק את Firestore:**
   - לך ל-Firestore → Data → feed
   - חפש פוסט עם `type: "game_created"` ו-`entityId: [gameId]`
   - אם הפוסט לא קיים, ה-Function לא עבדה

3. **בדוק את הקוד:**
   - ודא ש-`onGameCreated` מפורסמת: `firebase deploy --only functions:onGameCreated`
   - בדוק את `functions/index.js` שורות 140-183

**🔍 בדיקה נוספת:**
- בדוק שההאב עודכן: Firestore → hubs → [hubId]
- ודא שהשדה `gameCount` גדל ב-1
- ודא שהשדה `lastActivity` עודכן

---

## ✅ בדיקה 4: התראות פוש - Hub Chat (onHubMessageCreated)

### הכנה:
- צריך **2 מכשירים** או **2 משתמשים** (או לבדוק כשהאפליקציה ברקע)
- משתמש 1: שולח הודעה
- משתמש 2: אמור לקבל התראה

### צעד 4.1: הגדרת התראות
1. היכנס למסך ההגדרות
2. ודא שהתראות פוש מופעלות
3. אשר הרשאות להתראות (אם נדרש)

**✅ מה לבדוק:**
- [ ] האם FCM Token נוצר?
- [ ] בדוק ב-Firestore → users → [userId] → fcmToken (אם יש)

---

### צעד 4.2: שליחת הודעה בהאב צ'אט
1. היכנס להאב
2. לך לטאב "צ'אט" או "Chat"
3. שלח הודעה: `הודעה לבדיקה`

**✅ מה לבדוק (משתמש 1 - השולח):**
- [ ] האם ההודעה נשלחה?
- [ ] האם ההודעה מופיעה בצ'אט?

---

### צעד 4.3: בדיקת התראה (משתמש 2 - המקבל)

**אם יש לך 2 מכשירים:**
1. היכנס לאותו האב במכשיר השני (או משתמש אחר)
2. **השאר את האפליקציה ברקע** (או סגור אותה)
3. משתמש 1 שולח הודעה

**✅ מה לבדוק (משתמש 2):**
- [ ] האם קיבלת התראת פוש?
- [ ] האם ההתראה מכילה: `💬 הודעה חדשה ב-[שם ההאב]`?
- [ ] האם ההתראה מכילה את שם השולח וההודעה?
- [ ] האם לחיצה על ההתראה פותחת את האפליקציה לצ'אט?

**❌ אם לא קיבלת התראה:**
1. **בדוק את Firebase Functions:**
   - לך ל-Firebase Console → Functions → Logs
   - חפש את הפונקציה `onHubMessageCreated`
   - בדוק אם יש שגיאות

2. **בדוק את FCM Tokens:**
   - לך ל-Firestore → hubs → [hubId] → members
   - ודא שלכל חבר יש `fcmToken`
   - ודא שה-token של השולח לא נשלח (צריך להיות `doc.id !== message.senderId`)

3. **בדוק את Cloud Messaging:**
   - לך ל-Firebase Console → Cloud Messaging
   - בדוק אם יש הודעות שנשלחו

**🔍 בדיקה נוספת:**
- בדוק שההאב עודכן: Firestore → hubs → [hubId] → lastActivity
- ודא שהשדה עודכן לזמן של ההודעה

---

## ✅ בדיקה 5: חיפוש מגרשים - Google Maps API (searchVenues)

### צעד 5.1: פתיחת מסך חיפוש
1. היכנס להאב
2. לחץ על "צור משחק" או "הוסף מגרש"
3. לחץ על "חפש מגרש" או "Search Venue"

**✅ מה לבדוק:**
- [ ] האם המסך נפתח?
- [ ] האם יש שדה חיפוש?

---

### צעד 5.2: חיפוש מגרש
1. הקלד בשדה החיפוש: `מגרש כדורגל תל אביב` (או כל מיקום אחר)
2. לחץ "חפש" או לחץ Enter

**✅ מה לבדוק:**
- [ ] האם החיפוש מחזיר תוצאות?
- [ ] האם התוצאות מופיעות ברשימה?
- [ ] האם כל תוצאה מכילה:
  - שם המגרש
  - כתובת
  - מרחק (אם רלוונטי)

**❌ אם החיפוש לא עובד:**
1. **בדוק את Firebase Functions:**
   - לך ל-Firebase Console → Functions → Logs
   - חפש את הפונקציה `searchVenues`
   - בדוק אם יש שגיאות

2. **בדוק את API Key:**
   - ודא שה-Google Places API Key מוגדר ב-Environment Variables:
     ```bash
     firebase functions:config:get
     ```
   - או בדוק ב-Firebase Console → Functions → Configuration

3. **בדוק את הקוד:**
   - ודא ש-`searchVenues` מפורסמת: `firebase deploy --only functions:searchVenues`
   - בדוק את `functions/index.js` שורה 395

4. **בדוק את Google Cloud Console:**
   - ודא שה-API Key פעיל
   - ודא ש-Places API מופעל בפרויקט

**🔍 בדיקה נוספת:**
- נסה לחפש עם מיקום ספציפי (lat/lng)
- נסה לחפש עם רדיוס שונה
- בדוק אם יש מגרשים להשכרה (`includeRentals: true`)

---

## 📊 סיכום בדיקות

### ✅ בדיקות שעברו:
- [ ] אימות משתמש - הרשמה
- [ ] אימות משתמש - Google Sign In
- [ ] אימות משתמש - אנונימי
- [ ] יצירת Hub
- [ ] יצירת Game
- [ ] פוסט אוטומטי בפיד (onGameCreated)
- [ ] שליחת הודעה בהאב צ'אט
- [ ] התראת פוש (onHubMessageCreated)
- [ ] חיפוש מגרשים (searchVenues)

### ❌ בעיות שזוהו:
רשום כאן כל בעיה שזיהית:

1. **בעיה**: ________________
   - **מיקום**: ________________
   - **פתרון**: ________________

2. **בעיה**: ________________
   - **מיקום**: ________________
   - **פתרון**: ________________

---

## 🔧 פתרון בעיות נפוצות

### בעיה: Functions לא מופעלות
**פתרון:**
```bash
# בדוק שהן מפורסמות
firebase deploy --only functions

# בדוק את הלוגים
firebase functions:log
```

### בעיה: Firestore Rules חוסמות פעולות
**פתרון:**
- בדוק את `firestore.rules`
- ודא שהכללים מאפשרים את הפעולה
- בדוק ב-Firebase Console → Firestore → Rules

### בעיה: API Key לא עובד
**פתרון:**
- ודא שה-API Key מוגדר ב-Environment Variables
- ודא ש-Places API מופעל ב-Google Cloud Console
- בדוק שהמפתח לא מוגבל (או שההגבלות נכונות)

### בעיה: התראות לא נשלחות
**פתרון:**
- ודא ש-FCM Tokens מתוחזקים
- בדוק שהתראות מופעלות במכשיר
- ודא שהפונקציה `onHubMessageCreated` מפורסמת

---

## 📝 הערות חשובות

1. **פוסט כפול**: יש שני מקומות שיוצרים פוסט כשנוצר משחק:
   - בקוד הלקוח (`create_game_screen.dart`)
   - ב-Firebase Functions (`onGameCreated`)
   
   **מומלץ**: להסיר את הקוד מהלקוח ולהשאיר רק את ה-Function.

2. **בדיקות עם משתמשים מרובים**: מומלץ לבדוק את כל הפיצ'רים עם לפחות 2 משתמשים כדי לוודא שהתראות והפידים עובדים נכון.

3. **לוגים**: תמיד בדוק את הלוגים ב-Firebase Console כדי להבין מה קורה.

---

## 🎯 הצעדים הבאים

לאחר שכל הבדיקות עברו:
1. ✅ תיקון אזהרות deprecated methods
2. ✅ אופטימיזציית ביצועים
3. ✅ בדיקות נוספות

